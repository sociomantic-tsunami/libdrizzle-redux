language: cpp

## Cache dependencies and directories
cache: ccache

## Ensures the virtualization environment run as Ubuntu 14.04 Trusty
#  TRUSTY BETA
sudo: required
dist: trusty

os:
  - linux
  - osx

## Specifies the version of XCode for the The OS X Build Environment
#  default xcode7.3
# osx_image:

## Compilers to use for builds
compiler:
  - gcc
  - clang

services:
  - mysql

## The following environment variables are required for
#  running unittests
#  Environment variables can be defined in the repository, but
#  are overridden by values in .travis.yml.
#
#  Please refer to the section 'script' for info on
#  SKIP_TEST_ON_ERROR
env:
  - MYSQL_SERVER=127.0.0.1
    MYSQL_PASSWORD=''
    MYSQL_USER=root
    SKIP_TEST_ON_ERROR=0

## Defines packages to be installed by apt
#  2016/12/01 - mysql-5.6 was added to the default stack
#  for sudo enabled trusty builds,
#  The section is kept for reference since any additional packages
#  would still need to go into this section
#addons:
#  apt:
#    packages:

## The matrix combines options of Runtime, Environment and Exclusions/Inclusions
#  to define the build configurations
matrix:
  fast_finish: true
  exclude:
  - os: osx
    compiler: gcc

## This runs custom commands to install os specific dependencies
before_install:
    - ./travis_configure.sh before_install

## This script runs before the compiling
#  1. Stop MySQL server
#  2. Enable replication in mysql config file
#  3. Start MySQL server
#  4. Print mysql config for debug purposes
before_script:
  - ./travis_configure.sh before_script

## Build steps
#  - compile project
#  - run all tests with 'make check'
#
#  Please note that test fails on first error as default
#  To skip errors and fail silently set environment variable:
#    SKIP_TEST_ON_ERROR=1
script:
  - ./travis_configure.sh run_tests
