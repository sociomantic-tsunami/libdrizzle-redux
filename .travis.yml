language: cpp

sudo: required

os:
  - linux

compiler:
  - gcc
  - clang

dist: trusty

services:
 - mysql
 - docker

## Environment variables
#
#  The 'global' section defines variables which are added to every row in the
#  build matrix, i.e. every build configuration.
#  In turn, variables defined in the 'matrix' section each triggers a separate
#  build.
#
#  Please note that test fails on first error as default
#  To skip errors and fail silently set environment variable:
#    SKIP_TEST_ON_ERROR=1
env:
  global:
    - MYSQL_SERVER=127.0.0.1
      MYSQL_PASSWORD=''
      MYSQL_USER=root
      MYSQL_PORT=3306
      DIST_PACKAGE_TARGET=DEB
      SKIP_TEST_ON_ERROR=0
  matrix:
    - DIST_PACKAGE_TARGET=DEB
    - DIST_PACKAGE_TARGET=RPM

## Build matrix
#
#  The 'os', 'compiler' and 'env' settings are expanded into 3 jobs:
#
#  | os     | compiler | DIST_PACKAGE_TARGET |
#  |--------|----------|---------------------|
#  | linux  | clang    | DEB                 |
#  | linux  | gcc      | DEB                 |
#  | linux* | gcc      | RPM                 |
#
#  * the RPM package is built in a docker container running centos7
matrix:
  fast_finish: true
  exclude:
    - os: linux
      compiler: clang
      env: DIST_PACKAGE_TARGET=RPM

## Defines packages to be installed by apt
#  2016/12/01 - mysql-5.6 was added to the default stack
#  for sudo enabled trusty builds,
#  The section is kept for reference since any additional packages
#  would still need to go into this section
#addons:
#  apt:
#    packages:

## Install dependencies
before_install:
  - ./travis_configure.sh before_install

## Prepare build system for tests
before_script:
  - ./travis_configure.sh before_script

## Run tests, and packaging scripts
script:
  - ./travis_configure.sh run_tests
